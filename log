  @Test
    void testGetMerchantEncryptionKeysForDownload() throws IOException {

        String mId = "12345";
        String mek = "testKey";
        UUID id = UUID.randomUUID();
        String password = "securePwd";

        Map<String, String> expectedInput = new HashMap<>();
        expectedInput.put(MerchantConstant.MEK, mek);

        ByteArrayOutputStream pdfStream = new ByteArrayOutputStream();
        pdfStream.write(expectedInput.toString().getBytes());
        pdfStream.write(mId.getBytes());

        doNothing().when(keyValidator).validateMId(mId);
        when(keyDao.getMerchantEncryptionKeysForDownload(mId)).thenReturn(mek);
        doNothing().when(keyDao).saveNotification(eq(KeyType.ENCRYPTION), any(UUID.class), eq("Encryption Key PDF file Password is :" + password), eq(mId));

        when(passwordGenerator.generatePassword()).thenReturn(password);
        when(pdfService.generatedPDF(eq(expectedInput), eq(password), eq("encryption_key")))
                .thenReturn(pdfStream);

        // If keyService is a spy (or if you need to stub its internal call), use doReturn() for pdfFileGenerator.
        doReturn(pdfStream).when(keyService).pdfFileGenerator(mId, mek,id);
        doNothing().when(keyService).fileResponse(eq(KeyType.ENCRYPTION), any(), eq(response), eq(pdfStream));

        keyService.getMerchantEncryptionKeysForDownload(mId, response);

        verify(keyValidator).validateMId(mId);
        verify(keyDao).getMerchantEncryptionKeysForDownload(mId);
        verify(keyService).pdfFileGenerator(eq(mId), eq(mek), any(UUID.class));
        verify(keyService).fileResponse(eq(KeyType.ENCRYPTION), any(), eq(response), eq(pdfStream));
    }
	
Argument passed to when() is not a mock!
Example of correct stubbing:
    doThrow(new RuntimeException()).when(mock).someMethod();
org.mockito.exceptions.misusing.NotAMockException: 
Argument passed to when() is not a mock!
Example of correct stubbing:
    doThrow(new RuntimeException()).when(mock).someMethod();
	at com.epay.merchant.service.KeyServiceTest.testGetMerchantEncryptionKeysForDownload(KeyServiceTest.java:289)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)


    // If keyService is a spy (or if you need to stub its internal call), use doReturn() for pdfFileGenerator.
        doReturn(pdfStream).when(keyService).pdfFileGenerator(mId, mek,id);
